///////////////////////////////////////////////////////////////////////////////
//
// This file was automatically generated by RANOREX.
// http://www.ranorex.com
//
///////////////////////////////////////////////////////////////////////////////

using System;
using System.Collections.Generic;
using System.Text;
using System.Text.RegularExpressions;
using System.Drawing;
using System.Threading;
using System.Windows.Forms;
using System.IO;
using System.Diagnostics;
using System.Security.Principal;

using Ranorex;
using Ranorex.Core;

namespace SystemManagerLib.UISpecific.SetupPCI_ADSI
{
	/// <summary>
	/// The Setup recording.
	/// </summary>
	public partial class SetupPCI_ADSI
	{

		
	
		//*************************************************************************************//
		//**********Copies and overwrites config files if necessarys***************************//
		//*************************************************************************************//
		
		public void CopySiteFiles()
		{		
			
		string fileName1 = "Site1.site";
		string fileName2 = "Site2.site";
        string sourcePath = "DataFiles";
        string targetPath =  @"C:\Documents and Settings\All Users\Documents\Ultra Electronics Inc\System Manager";

        // Use Path class to manipulate file and directory paths.
        string sourceFile1 = System.IO.Path.Combine(sourcePath, fileName1);
        string destFile1 = System.IO.Path.Combine(targetPath, fileName1);
       
        string sourceFile2 = System.IO.Path.Combine(sourcePath, fileName2);
        string destFile2 = System.IO.Path.Combine(targetPath, fileName2);
        
        // To copy a folder's contents to a new location:
        // Create a new target folder, if necessary.
        if (!System.IO.Directory.Exists(targetPath))
        {
            System.IO.Directory.CreateDirectory(targetPath);
        }

        // To copy a file to another location and 
        // overwrite the destination file if it already exists.
        System.IO.File.Copy(sourceFile1, destFile1, true);	
        System.IO.File.Copy(sourceFile2, destFile2, true);
        Report.Info("Copied " + fileName1 + " & " + fileName2 + " to C:/Documents and Settings/All Users/Documents/Ultra Electronics Inc/System Manager");
		}
		
		
		//*************************************************************************************//
		//**********Deletes System Manager Connections File************************************//
		//*************************************************************************************//
		
		public void DeleteSMConfig()
		{			

			if (File.Exists(@"C:\Documents and Settings\All Users\Documents\Ultra Electronics Inc\System Manager\configs.dat"))
      	    {
        	FileInfo SMConfFile = new FileInfo(@"C:\Documents and Settings\All Users\Documents\Ultra Electronics Inc\System Manager\configs.dat");
        	SMConfFile.Delete();
        	Report.Info("Deleted C:/Documents and Settings/All Users/Documents/Ultra Electronics Inc/System Manager/configs.dat");
      	    }
			else 
			{
				Report.Warn("Failed to find C:/Documents and Settings/All Users/Documents/Ultra Electronics Inc/System Manager/configs.dat, skipping deletion");
			}
			
		}
            
        
		
		//**************************************************************************************//
		//********************************Populates C2Host IP Address***************************//
		//**************************************************************************************//
		
		public void C2H_ip()
		{

			Report.Info("Key sequence " + C2Hip);
			Keyboard.Press(C2Hip);
		}		
		
		//**************************************************************************************//
		//********************************Populates TDLG IP Address*****************************//
		//**************************************************************************************//
		
		public void TDLG_ip()
		{

			Report.Info("Key sequence " + TDLGip);
			Keyboard.Press(TDLGip);
		}	
		
		
		
		public void DataLinkStatus()
		{
			
			if (repo.FormSystem_Manager___UNCLASS.TitleBarData_LinksInfo.Exists())
			{
			return;
			}
			else
			{
			repo.FormSystem_Manager___UNCLASS.ElementSm.Click("42;8");
			repo.FormSm.MenuItemData_Links.Click("59;16");	
			}
		}


		public void ApplicationStatus()
		{
			if (repo.FormSystem_Manager___UNCLASS.TitleBarApplication_StatusInfo.Exists())
			{
			return;
			}
			else
			{
			repo.FormSystem_Manager___UNCLASS.ElementSm.Click("44;13");
			repo.FormSm.MenuItemApplication_Status.Click("34;6");
			}
		}

		public void LoadSite1()
		{
			
			Duration OrigDur = repo.FormSite_Creation_Needed.SearchTimeout;
			repo.FormSite_Creation_Needed.SearchTimeout = 2000;
			Report.Info("Checking to see if site setup is required");
			
			if (repo.FormSite_Creation_Needed.TextSetupSiteInfo.Exists())
				{
				//Your code here. Code inside this method will not be changed by the code generator.
				Report.Info("Site setup is required");
				repo.FormSite_Creation_Needed.ButtonLoad_Site.Click("23;13");
				
				Report.Info("Checking for load site from file warning dialogue");
				if (repo.FormLoad_Site_File.ButtonYesInfo.Exists())
					{
					Report.Info("Mouse Left Click item 'FormLoad_Site_File.ButtonYes' at 32;14.");
					repo.FormLoad_Site_File.ButtonYes.Click("32;14");
					}
				
				Report.Info("Loading saved site");
				repo.FormLoad_a_Site.ListItemSite1_site.Click("40;9");
				repo.FormLoad_a_Site.ButtonOpen.Click("23;5");
				Report.Info("Site file has been loaded");
				}
			
			Report.Info("Load site dialogue not detected");
			repo.FormSite_Creation_Needed.SearchTimeout = OrigDur;

		}


		public void StartStopRestartC2H()
		{
			Duration OrigDur1 = repo.C2H_StateInfo.SearchTimeout;
			repo.C2H_StateInfo.SearchTimeout = 3000;			
			
			if (repo.C2H_State.TextValue.Equals("Running"))
			{
				Report.Info("C2H is currently running, Mouse Left Click item 'FormSystem_Manager___UNCLASS.TextRestart'");
				repo.FormSystem_Manager___UNCLASS.TextRestart.Click();
				Report.Info("Mouse Left Click item 'FormSegment_Restart.ButtonYes'");
				repo.FormSegment_Restart.ButtonYes.Click();
				Report.Info("Waiting for C2H to change to Running state");
				
				while (repo.C2H_State.TextValue.Equals("Restarting"))
				{
					Report.Info("Waiting for C2H state to change");
					Delay.Seconds(1);
				}
				
				while (repo.C2H_State.TextValue.Equals("Stopping"))
				{
					Report.Info("Waiting for C2H state to change to Running");
					Delay.Seconds(1);
				}
				
				while (repo.C2H_State.TextValue.Equals("Generating"))
				{
					Report.Info("Waiting for C2H state to change to Running");
					Delay.Seconds(1);
				}
				
				while (repo.C2H_State.TextValue.Equals("Starting"))
				{
					Report.Info("Waiting for C2H state to change to Running");
					Delay.Seconds(1);
				}
				
				Delay.Seconds(5);
				Report.Info("Validating AttributeEqual (Text='Running')");
				Validate.Attribute(repo.C2H_StateInfo, "Text", "Running");	
				
				repo.C2H_StateInfo.SearchTimeout = OrigDur1;
			}
		
			else
			{
			
				if (repo.C2H_State.TextValue.Equals("Stopped"))
				{
					Report.Info("C2H is currently stopped, Mouse Left Click item 'FormSystem_Manager___UNCLASS.TextStart'");
					repo.FormSystem_Manager___UNCLASS.TextStart.Click();
					Report.Info("Mouse Left Click item 'FormSystem_Manager___UNCLASS.TextStart'");
					Report.Info("Waiting for C2H to change to Running state");
					
					while (repo.C2H_State.TextValue.Equals("Starting"))
					{
						Report.Info("Waiting for C2H state to change");
						Delay.Milliseconds(500);
					}
					
					while (repo.C2H_State.TextValue.Equals("Generating"))
					{
						Report.Info("Waiting for C2H state to change to Running");
						Delay.Seconds(1);
					}

					Delay.Seconds(5);
					Report.Info("Validating AttributeEqual (Text='Running')");
					Validate.Attribute(repo.C2H_StateInfo, "Text", "Running");	
				}
				
				else
				{
					if (repo.C2H_State.TextValue.Equals("Fault"))
					{
						Report.Info("C2H is currently in a Fault state, Attempting to stop & start the system");
						Report.Info("Mouse Left Click item 'FormSystem_Manager___UNCLASS.TextStop'");
						repo.FormSystem_Manager___UNCLASS.TextStop.Click();
						Report.Info("Mouse Left Click item 'FormSegment_Stop.ButtonYes'");
						repo.FormSegment_Stop.ButtonYes.Click();
						Report.Info("Waiting for C2H to change to Running state");
						
						while (repo.C2H_State.TextValue.Equals("Stopping"))
							{
							Report.Info("Waiting for C2H state to change");
							Delay.Milliseconds(500);
							}
						
						Delay.Seconds(3);
						Report.Info("Validating AttributeEqual (Text='Stopped')");
						Validate.Attribute(repo.C2H_StateInfo, "Text", "Stopped");	
						
						Report.Info("Mouse Left Click item 'FormSystem_Manager___UNCLASS.TextStart'");
						repo.FormSystem_Manager___UNCLASS.TextStart.Click();
						Report.Info("Validating AttributeEqual (Text='Starting')");
						Validate.Attribute(repo.C2H_StateInfo, "Text", "Starting");
						
						while (repo.C2H_State.TextValue.Equals("Starting"))
							{
							Report.Info("Waiting for C2H state to change");
							Delay.Milliseconds(500);
							}
						
						while (repo.C2H_State.TextValue.Equals("Generating"))
							{
							Report.Info("Waiting for C2H state to change to Running");
							Delay.Seconds(1);
							}
						
						Delay.Seconds(3);
						Report.Info("Validating AttributeEqual (Text='Running')");
						Validate.Attribute(repo.C2H_StateInfo, "Text", "Running");	
						
					}
					else
					{
						Report.Error("Unable to find a valid system state of Running, Stopped, or Fault on the C2H Segment");
					}
				}
			}
					
			repo.C2H_StateInfo.SearchTimeout = OrigDur1;
			
		}
			
		
		
		public void StartStopRestartTDLG()
		{
			Duration OrigDur1 = repo.TDLG_StateInfo.SearchTimeout;
			repo.TDLG_StateInfo.SearchTimeout = 3000;			
			
			if (repo.TDLG_State.TextValue.Equals("Running"))
			{
				Report.Info("TDLG is currently running, Mouse Left Click item 'FormSystem_Manager___UNCLASS.TextRestart'");
				repo.FormSystem_Manager___UNCLASS.TextRestart2.Click();
				Report.Info("Mouse Left Click item 'FormSegment_Restart.ButtonYes'");
				repo.FormSegment_Restart.ButtonYes.Click();
				Report.Info("Waiting for TDLG to change to Running state");	
				
				while (repo.TDLG_State.TextValue.Equals("Restarting"))
				{
					Report.Info("Waiting for TDLG state to change");
					Delay.Seconds(1);
				}
				
				while (repo.TDLG_State.TextValue.Equals("Stopping"))
				{
					Report.Info("Waiting for TDLG state to change to Running");
					Delay.Seconds(1);
				}
				
				while (repo.TDLG_State.TextValue.Equals("Generating"))
				{
					Report.Info("Waiting for TDLG state to change to Running");
					Delay.Seconds(1);
				}
				
				while (repo.TDLG_State.TextValue.Equals("Starting"))
				{
					Report.Info("Waiting for TDLG state to change to Running");
					Delay.Seconds(1);
				}
				
				Delay.Seconds(5);
				Report.Info("Validating AttributeEqual (Text='Running')");
				Validate.Attribute(repo.TDLG_StateInfo, "Text", "Running");	
				
				repo.TDLG_StateInfo.SearchTimeout = OrigDur1;
			}
		
			else
			{
			
				if (repo.TDLG_State.TextValue.Equals("Stopped"))
				{
					Report.Info("TDLG is currently stopped, Mouse Left Click item 'FormSystem_Manager___UNCLASS.TextStart'");
					repo.FormSystem_Manager___UNCLASS.TextStart2.Click();
					Report.Info("Mouse Left Click item 'FormSystem_Manager___UNCLASS.TextStart'");
					Report.Info("Waiting for TDLG to change to Running state");
					
					while (repo.TDLG_State.TextValue.Equals("Starting"))
					{
						Report.Info("Waiting for TDLG state to change");
						Delay.Milliseconds(500);
					}
					
					while (repo.TDLG_State.TextValue.Equals("Generating"))
					{
						Report.Info("Waiting for TDLG state to change to Running");
						Delay.Seconds(1);
					}

					Delay.Seconds(5);
					Report.Info("Validating AttributeEqual (Text='Running')");
					Validate.Attribute(repo.TDLG_StateInfo, "Text", "Running");	
				}
				
				else
				{
					if (repo.TDLG_State.TextValue.Equals("Fault"))
					{
						Report.Info("TDLG is currently in a Fault state, Attempting to stop & start the system");
						Report.Info("Mouse Left Click item 'FormSystem_Manager___UNCLASS.TextStop'");
						repo.FormSystem_Manager___UNCLASS.TextStop2.Click();
						Report.Info("Mouse Left Click item 'FormSegment_Stop.ButtonYes'");
						repo.FormSegment_Restart.ButtonYes.Click();
						Report.Info("Waiting for TDLG to change to Running state");
						
						while (repo.C2H_State.TextValue.Equals("Stopping"))
							{
							Report.Info("Waiting for C2H state to change");
							Delay.Milliseconds(500);
							}
						
						Delay.Seconds(5);
						Report.Info("Validating AttributeEqual (Text='Stopped')");
						Validate.Attribute(repo.C2H_StateInfo, "Text", "Stopped");	
						
						Report.Info("Mouse Left Click item 'FormSystem_Manager___UNCLASS.TextStart'");
						repo.FormSystem_Manager___UNCLASS.TextStart2.Click();
						Report.Info("Validating AttributeEqual (Text='Starting')");
						Validate.Attribute(repo.C2H_StateInfo, "Text", "Starting");
						
						while (repo.C2H_State.TextValue.Equals("Starting"))
							{
							Report.Info("Waiting for C2H state to change");
							Delay.Milliseconds(500);
							}
						
						while (repo.C2H_State.TextValue.Equals("Generating"))
						{
							Report.Info("Waiting for C2H state to change to Running");
							Delay.Seconds(1);
						}
						
						Delay.Seconds(5);
						Report.Info("Validating AttributeEqual (Text='Running')");
						Validate.Attribute(repo.C2H_StateInfo, "Text", "Running");	
						
					}
					else
					{
						Report.Error("Unable to find a valid system state of Running, Stopped, or Fault on the TDLG Segment");
					}
				}
			}
					
			repo.TDLG_StateInfo.SearchTimeout = OrigDur1;
			
		}
		
		

		public void ToggleLink()
		{
			
			Duration OrigDur1 = repo.FormSystem_Manager___UNCLASS.CellOFFInfo.SearchTimeout;
			repo.FormSystem_Manager___UNCLASS.CellOFFInfo.SearchTimeout = 1000;
			Duration OrigDur2 = repo.FormSystem_Manager___UNCLASS.CellONInfo.SearchTimeout;
			repo.FormSystem_Manager___UNCLASS.CellONInfo.SearchTimeout = 1000;
			Duration OrigDur3 = repo.FormSystem_Manager___UNCLASS.CellOPERInfo.SearchTimeout;
			repo.FormSystem_Manager___UNCLASS.CellOPERInfo.SearchTimeout = 1000;

			if (repo.FormSystem_Manager___UNCLASS.CellOFFInfo.Exists())
			    {
				Report.Info("Data Link is turned OFF, attemtping to turn ON");
				Report.Info("Mouse Left Click item 'FormSystem_Manager___UNCLASS.CellOFF'");
				repo.FormSystem_Manager___UNCLASS.CellOFFInfo.SearchTimeout = OrigDur1;
				repo.FormSystem_Manager___UNCLASS.CellOFF.Click("17;15");
				repo.FormSystem_Manager___UNCLASS.CellONInfo.SearchTimeout = OrigDur2;
				Validate.Attribute(repo.FormSystem_Manager___UNCLASS.CellONInfo, "Text", "ON");	
				}

			else
			{	
			    
			    if (repo.FormSystem_Manager___UNCLASS.CellONInfo.Exists())
				    {
				    Report.Info("Data Link is already turned ON");
				   	Report.Info("Mouse Left Click item 'FormSystem_Manager___UNCLASS.CellON'");
					repo.FormSystem_Manager___UNCLASS.CellON.Click("17;15"); 
					repo.FormSystem_Manager___UNCLASS.CellOFFInfo.SearchTimeout = OrigDur1;
					Validate.Attribute(repo.FormSystem_Manager___UNCLASS.CellOFFInfo, "Text", "OFF");	
					Report.Info("Mouse Left Click item 'FormSystem_Manager___UNCLASS.CellOFF'");
					repo.FormSystem_Manager___UNCLASS.CellOFF.Click("17;15");
					repo.FormSystem_Manager___UNCLASS.CellONInfo.SearchTimeout = OrigDur2;
					Validate.Attribute(repo.FormSystem_Manager___UNCLASS.CellONInfo, "Text", "ON");
				    }
			    
			    else
			    {
			    	
					if (repo.FormSystem_Manager___UNCLASS.CellOPERInfo.Exists())
					    {
					    Report.Info("Link is already OPER, attempting to toggle the link");
					   	Report.Info("Mouse Left Click item 'FormSystem_Manager___UNCLASS.CellOPER'");
						repo.FormSystem_Manager___UNCLASS.CellOPER.Click("17;15"); 
						repo.FormSystem_Manager___UNCLASS.CellOFFInfo.SearchTimeout = OrigDur1;
						Validate.Attribute(repo.FormSystem_Manager___UNCLASS.CellOFFInfo, "Text", "OFF");
						Report.Info("Mouse Left Click item 'FormSystem_Manager___UNCLASS.CellOFF'");
						repo.FormSystem_Manager___UNCLASS.CellOFF.Click("17;15");
						repo.FormSystem_Manager___UNCLASS.CellONInfo.SearchTimeout = OrigDur2;
						Validate.Attribute(repo.FormSystem_Manager___UNCLASS.CellONInfo, "Text", "ON");
					    }
					else
						{
						Report.Error("Unable to find valid data link status");
						}
			    }
			}
			
			repo.FormSystem_Manager___UNCLASS.CellOFFInfo.SearchTimeout = OrigDur1;
			repo.FormSystem_Manager___UNCLASS.CellONInfo.SearchTimeout = OrigDur2;
			repo.FormSystem_Manager___UNCLASS.CellOPERInfo.SearchTimeout = OrigDur3;			
			
		}

		public void LaunchSM()
		{
		Report.Info("Launching System Manager");
		CommonUtilLib.Util SharedFunctions = new CommonUtilLib.Util();
		int OSBit = SharedFunctions.OSBit();
				
			if (OSBit == 32)
			{
				Process SystemManager = new Process();
				SystemManager.StartInfo.FileName = @"C:\Program Files\Ultra Electronics Inc\ADSI\current\bin\sm.exe";
				SystemManager.Start();
			}
			else
			{
				Process SystemManager = new Process();
				SystemManager.StartInfo.FileName = @"C:\Program Files (x86)\Ultra Electronics Inc\ADSI\current\bin\sm.exe";
				SystemManager.Start();
			}
		}

		public void Validate_C2H_Connected()
		{
			Duration OrigDur = repo.FormSystem_Manager___UNCLASS.C2H_ConnectionInfo.SearchTimeout;
			repo.FormSystem_Manager___UNCLASS.C2H_ConnectionInfo.SearchTimeout = 1000;			
			
				if (repo.FormSystem_Manager___UNCLASS.C2H_Connection.TextValue.Equals("Connected"))
					{
					Report.Info("Validating AttributeEqual (Text='Connected')");
					Validate.Attribute(repo.FormSystem_Manager___UNCLASS.C2H_ConnectionInfo, "Text", "Connected");
					}
				
				else
					{
					////// Restarts C2H System Manager daemon on Linux //////
					Report.Info("Connected not found, restarting System Manager daemon on the C2H");
					System.Diagnostics.Process C2Hdaemon = new System.Diagnostics.Process();
					C2Hdaemon.StartInfo.FileName=@"c:/Program Files/Attachmate/RSecure/ssh.exe";
					C2Hdaemon.StartInfo.Arguments="-i ../keys/key -o StrictHostKeyChecking=no adsi@" + C2Hip + " SM_RESTART";
					C2Hdaemon.Start();
					C2Hdaemon.WaitForExit();
					Delay.Seconds(5);
					Report.Info("Validating AttributeEqual (Text='Connected')");
					Validate.Attribute(repo.FormSystem_Manager___UNCLASS.C2H_ConnectionInfo, "Text", "Connected");
					}
				
			repo.FormSystem_Manager___UNCLASS.C2H_ConnectionInfo.SearchTimeout = OrigDur;
			
		}
		
		
		public void Validate_TDLG_Connected()
		{
			Duration OrigDur = repo.FormSystem_Manager___UNCLASS.TDLG_ConnectionInfo.SearchTimeout;
			repo.FormSystem_Manager___UNCLASS.TDLG_ConnectionInfo.SearchTimeout = 1000;			
			
				if (repo.FormSystem_Manager___UNCLASS.TDLG_Connection.TextValue.Equals("Connected"))
					{
					Report.Info("Validating AttributeEqual (Text='Connected')");
					Validate.Attribute(repo.FormSystem_Manager___UNCLASS.TDLG_ConnectionInfo, "Text", "Connected");
					}
				
				else
					{
					////// Restarts C2H System Manager daemon on Linux //////
					Report.Info("Connected not found, restarting System Manager daemon on the C2H");
					System.Diagnostics.Process TDLGdaemon = new System.Diagnostics.Process();
					TDLGdaemon.StartInfo.FileName=@"c:/Program Files/Attachmate/RSecure/ssh.exe";
					TDLGdaemon.StartInfo.Arguments="-i ../keys/key -o StrictHostKeyChecking=no adsi@" + C2Hip + " SM_RESTART";
					TDLGdaemon.Start();
					TDLGdaemon.WaitForExit();
					Delay.Seconds(5);
					Report.Info("Validating AttributeEqual (Text='Connected')");
					Validate.Attribute(repo.FormSystem_Manager___UNCLASS.TDLG_ConnectionInfo, "Text", "Connected");
					}
				
			repo.FormSystem_Manager___UNCLASS.TDLG_ConnectionInfo.SearchTimeout = OrigDur;
			
		}
		


		static SetupPCI_ADSI()
		{
			//Your recording specific initialization code goes here.
		}


		private void Init()
		{
			// Your recording specific initialization code goes here.
		}

        public void GetFocusSM()
        {
        	repo.FormSystem_Manager___UNCLASS.TitleBarSystem_Manager___UNCLASS.Focus();
        	Delay.Milliseconds(250);
        }


        public void RemoveAutostart()
        {
		
        string usr = WindowsIdentity.GetCurrent().Name.Split('\\')[1];	
		string fileName = "sm.ini";
        string sourcePath = "DataFiles";
        string targetPath =  @"C:\Users\" + usr + @"\Documents\Ultra Electronics Inc\System Manager";

        // Use Path class to manipulate file and directory paths.
        string sourceFile = System.IO.Path.Combine(sourcePath, fileName);
        string destFile = System.IO.Path.Combine(targetPath, fileName);
        
        // To copy a folder's contents to a new location:
        // Create a new target folder, if necessary.
        if (!System.IO.Directory.Exists(targetPath))
        {
            System.IO.Directory.CreateDirectory(targetPath);
        }

        // To copy a file to another location and 
        // overwrite the destination file if it already exists.
        System.IO.File.Copy(sourceFile, destFile, true);	
        Report.Info("Copied " + fileName + " to " + targetPath);
		}
	
					
	}
}