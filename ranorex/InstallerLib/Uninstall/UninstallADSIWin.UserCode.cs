///////////////////////////////////////////////////////////////////////////////
//
// This file was automatically generated by RANOREX.
// http://www.ranorex.com
//
///////////////////////////////////////////////////////////////////////////////

using System;
using System.Collections.Generic;
using System.Text;
using System.Text.RegularExpressions;
using System.Drawing;
using System.Threading;
using System.Windows.Forms;
using System.IO;
using System.Management;

using Ranorex;
using Ranorex.Core;

namespace InstallerLib.Uninstall
{
	/// <summary>
	/// The UninstallADSI recording.
	/// </summary>
	public partial class UninstallADSIWin
	{
		public string WinADSI;
		public string TV;
		
		
		public void GetADSIName()
		{
			Console.WriteLine("Checking to see if version 15 software is installed");
			Report.Info("Checking to see if version 15 software is installed");
			
			SelectQuery ADSIWinProductQuery = new SelectQuery("Select IdentifyingNumber from Win32_Product Where Name = 'Version 15 Windows Software'");
		    
			ManagementObjectSearcher ADSIWinProduct = new ManagementObjectSearcher(ADSIWinProductQuery);

			foreach(ManagementObject product in ADSIWinProduct.Get())

				{

					foreach(PropertyData property in product.Properties)

					{	

					WinADSI = property.Value.ToString();
			
					}
				}
		}
	
		public void GetTVName()
		{
			SelectQuery TVProductQuery = new SelectQuery("Select IdentifyingNumber from Win32_Product Where Name Like 'TacViewC2%'");
		    
			ManagementObjectSearcher TVProduct = new ManagementObjectSearcher(TVProductQuery);	
			
			foreach(ManagementObject product in TVProduct.Get())

				{

					foreach(PropertyData property in product.Properties)

					{	

					TV = property.Value.ToString();
			
					}
				}
		}
		
		public void UninstallADSI()

		{

			if (WinADSI != null)
		
			{
				
			////// Killing any running ADSI processes //////	
			/// 
			CommonUtilLib.Util SharedFunctions = new CommonUtilLib.Util();
	
			SharedFunctions.KillProcess("sm.exe");
			SharedFunctions.KillProcess("sm.exe");
		    SharedFunctions.KillProcess("c2c.exe");   
		    SharedFunctions.KillProcess("c2m.exe");
		    SharedFunctions.KillProcess("qtderg.exe");
		    SharedFunctions.KillProcess("mids.exe");
		    SharedFunctions.KillProcess("mids_x25.exe");
		    SharedFunctions.KillProcess("FTMClient.exe");
		    SharedFunctions.KillProcess("cfgwizard.exe");
		    SharedFunctions.KillProcess("loader.exe");
		    SharedFunctions.KillProcess("RealView.exe");

			////// Uninstall ADSI Windows //////
				
			System.Diagnostics.Process UninstallADSIWin = new System.Diagnostics.Process();
			UninstallADSIWin.EnableRaisingEvents=false;
			UninstallADSIWin.StartInfo.FileName=@"C:/WINDOWS/system32/msiexec.exe";
			UninstallADSIWin.StartInfo.Arguments="/x " + WinADSI + " /qb";
			UninstallADSIWin.Start();
			Console.WriteLine("Uninstalling Version 15 Windows Software");
			Report.Info("Uninstalling ADSI Windows");
			UninstallADSIWin.WaitForInputIdle();
			UninstallADSIWin.WaitForExit();
			Console.WriteLine("Finished uninstalling Version 15 Windows Software");
			Report.Info("Finished uninstalling ADSI Windows");
			}

		
		}
		
		public void UninstallTV()

		{
			if (TV != null)
			
			{

			////// Uninstall TacViewC2 //////
				
			System.Diagnostics.Process UninstallTV = new System.Diagnostics.Process();
			UninstallTV.EnableRaisingEvents=false;
			UninstallTV.StartInfo.FileName=@"C:/WINDOWS/system32/msiexec.exe";
			UninstallTV.StartInfo.Arguments="/x " + TV + " /qb";
			UninstallTV.Start();
			UninstallTV.WaitForInputIdle();
			UninstallTV.WaitForExit();
			}
		
		}

		static UninstallADSIWin()
		{
			//Your recording specific initialization code goes here.
		}

		private void Init()
		{
			// Your recording specific initialization code goes here.
		}

	}
}
