///////////////////////////////////////////////////////////////////////////////
//
// This file was automatically generated by RANOREX.
// http://www.ranorex.com
//
///////////////////////////////////////////////////////////////////////////////

using System;
using System.Collections.Generic;
using System.Text;
using System.Text.RegularExpressions;
using System.Drawing;
using System.Threading;
using System.Windows.Forms;
using System.IO;
using System.Management;
using System.Security.Principal;

using Ranorex;
using Ranorex.Core;

namespace InstallerLib.Uninstall
{
	/// <summary>
	/// The UninstallADSI recording.
	/// </summary>
	public partial class UninstallTV
	{
		public string WinADSI;
		public string TV;
		
		
	
		public void GetTVName()
		{
			Console.WriteLine("Checking to see if TacViewC2 software is installed");
			Report.Info("Checking to see if TacViewC2 software is installed");
			
			SelectQuery TVProductQuery = new SelectQuery("Select IdentifyingNumber from Win32_Product Where Name Like 'TacViewC2%'");
		    
			ManagementObjectSearcher TVProduct = new ManagementObjectSearcher(TVProductQuery);	
			
			foreach(ManagementObject product in TVProduct.Get())

				{

					foreach(PropertyData property in product.Properties)

					{	

					TV = property.Value.ToString();
			
					}
				}
		}
		
		
		
		
		
		
		public void UninstallTacView()

		{
			if (TV != null)
			
			{
				
			////// Killing any running TacView processes //////	
			/// 
			CommonUtilLib.Util SharedFunctions = new CommonUtilLib.Util();
	
			SharedFunctions.KillProcess("RealView.exe");

			////// Uninstall TacViewC2 //////
				
			System.Diagnostics.Process UninstallTV = new System.Diagnostics.Process();
			UninstallTV.EnableRaisingEvents=false;
			UninstallTV.StartInfo.FileName=@"C:/WINDOWS/system32/msiexec.exe";
			UninstallTV.StartInfo.Arguments="/x " + TV + @" /qb /Lime TVuninstallLog.txt";
			UninstallTV.Start();
			Report.Info("Uninstalling TacView");
//			Report.Info("Checking to see if close application dialogue appears");
//						
//				if (repo.ButtonIgnoreInfo.Exists())
//				{
//					Report.Info("Close application dialogue detected, clicking ignore to continue uninstall");
//					repo.ButtonIgnore.Click();
//				}
//				
//				else
//				{
//					Report.Info("Close application dialogue not detected, continuing with uninstall");
//				}
				
				
			UninstallTV.WaitForInputIdle();
			UninstallTV.WaitForExit();			
			Report.Info("Finished uninstalling TacView");
			}
		
		}

		static UninstallTV()
		{
			//Your recording specific initialization code goes here.
		}

		private void Init()
		{
			// Your recording specific initialization code goes here.
		}

        public void RemoveTVFiles()
        {
        	
        	string usr = WindowsIdentity.GetCurrent().Name.Split('\\')[1];
        	string dir1 = @"C:/Users/" + usr + "/AppData/Roaming/Ultra Electronics Inc";
        	string dir2 = @"C:/Users/" + usr + "/Documents/TacViewC2";
        	
        	
        	if (Directory.Exists(dir1))
        	    {
        	    	Report.Info("Deleting Directory " + dir1);
        	    	Directory.Delete(dir1, true);
        	    }
        	    
        	if (Directory.Exists(dir2))
        	    {
        	        Report.Info("Deleting Directory " + dir2);
        	    	Directory.Delete(dir2, true);
        	    }
            
        }

	}
}
